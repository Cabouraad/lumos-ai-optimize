project_id = "cgocsffxqyhojtyzniyz"

[functions.citation-mention]
verify_jwt = false

# TODO: Security audit completed - All verify_jwt=false functions have proper internal auth:
# - daily-batch-trigger: Validates cron secret against database
# - daily-scheduler-deprecated: Legacy function (consider removal)  
# - batch-reconciler: Validates cron secret + supports manual calls
# - robust-batch-processor: Requires Bearer token OR valid cron secret
# - stripe-webhook: Uses Stripe signature validation (industry standard)
# - weekly-report: Validates CRON_SECRET for scheduled runs OR valid JWT for user requests

[functions.daily-batch-trigger]
verify_jwt = false
import_map = ""

[functions.admin-batch-trigger]
verify_jwt = true

[functions.daily-scheduler-deprecated]
verify_jwt = false

[functions.batch-reconciler]
verify_jwt = false

[functions.enhanced-prompt-suggestions]
verify_jwt = true

[functions.analyze-ai-response]
verify_jwt = true

[functions.brand-enrich]
verify_jwt = true

[functions.sync-cron-secret]
verify_jwt = true

[functions.sync-competitor-detection]
verify_jwt = true

[functions.fix-prompt-classification]
verify_jwt = true

[functions.robust-batch-processor]
verify_jwt = false

[functions.robust-batch-processor.env]
ENABLE_GOOGLE_AIO = "true"

[functions.check-subscription]
verify_jwt = true

[functions.create-checkout]
verify_jwt = false

[functions.customer-portal]
verify_jwt = true

[functions.weekly-suggestions]
verify_jwt = true

[functions.verify-domain]
verify_jwt = true

[functions.run-prompt-now]
verify_jwt = false

[functions.run-prompt-now.env]
ENABLE_GOOGLE_AIO = "true"

[functions.suggest-prompts-now]
verify_jwt = true

[functions.onboarding]
verify_jwt = true

[functions.auto-fill-business-context]
verify_jwt = true

[functions.advanced-recommendations]
verify_jwt = true

[functions.optimization-worker]
verify_jwt = false

[functions.generate-recommendations]
verify_jwt = true

[functions.test-prompt-response]
verify_jwt = true

[functions.delete-account]
verify_jwt = true

[functions.ensure-user-record]
verify_jwt = true

[functions.llms-generate]
verify_jwt = true

[functions.create-trial-checkout]
verify_jwt = false

[functions.activate-trial]
verify_jwt = true

[functions.auto-audit]
verify_jwt = false

[functions.test-single-provider]
verify_jwt = true

[functions.convert-competitor-to-brand]
verify_jwt = true

[functions.grant-starter-bypass]
verify_jwt = true

[functions.remove-test-access]
verify_jwt = true

[functions.remove-bypass]
verify_jwt = true

[functions.stripe-webhook]
verify_jwt = false

[functions.generate-weekly-report]
verify_jwt = false

[functions.weekly-report-scheduler]
verify_jwt = false

[functions.weekly-report]
verify_jwt = false

[functions.reports-sign]
verify_jwt = true

[functions.check-subscription-scheduled]
verify_jwt = false

[functions.diag]
verify_jwt = false

[functions.schedule-dry-run]
verify_jwt = false

[functions.scheduler-postcheck]
verify_jwt = false

[functions.cron-manager]
verify_jwt = false

[functions.scheduler-diagnostics]
verify_jwt = false

[functions.manual-daily-run]
verify_jwt = false

[functions.debug-response-data]
verify_jwt = true

[functions.test-analysis-fixes]
verify_jwt = true

[functions.backfill-weekly-reports]
verify_jwt = true

[functions.scheduled-prompt-executor]
verify_jwt = false

[functions.run-tests]
verify_jwt = true

[functions.fetch-google-aio]
verify_jwt = false

[functions.fetch-google-aio.env]
ENABLE_GOOGLE_AIO = "true"

[functions.prompt-execution-guardian]
verify_jwt = false

[functions.execution-monitor]
verify_jwt = false

[functions.compute-llumos-score]
verify_jwt = false

# Scheduled runs - BULLETPROOF CONFIGURATION
[functions.schedules]
# === WEEKLY REPORTS ===
weekly_reports_unified = { schedule = "0 8 * * MON", endpoint = "/weekly-report-scheduler", method = "POST", headers = { "x-cron-secret" = "${CRON_SECRET}" } }

# === SUBSCRIPTION CHECKS ===
daily_subscription_check = { schedule = "0 2 * * *", endpoint = "/check-subscription-scheduled", method = "POST", headers = { "x-cron-secret" = "${CRON_SECRET}" } }

# === AUTO AUDIT ===
auto_audit_nightly = { schedule = "0 7 * * *", endpoint = "/auto-audit", method = "POST", headers = { authorization = "Bearer ${CRON_SECRET}" } }

# === CRITICAL: DAILY PROMPT EXECUTION (Multi-layered) ===
# Primary execution at 5:00 AM UTC (12:00 AM EST)
daily_prompt_execution_primary = { schedule = "0 5 * * *", endpoint = "/daily-batch-trigger", method = "POST", headers = { "x-cron-secret" = "${CRON_SECRET}" }, body = "{\"force\": true, \"trigger_source\": \"scheduled_primary\"}" }

# Backup execution #1 at 5:30 AM UTC (12:30 AM EST)
daily_prompt_execution_backup_530 = { schedule = "30 5 * * *", endpoint = "/daily-batch-trigger", method = "POST", headers = { "x-cron-secret" = "${CRON_SECRET}" }, body = "{\"force\": false, \"trigger_source\": \"scheduled_backup_530\"}" }

# Backup execution #2 at 6:00 AM UTC (1:00 AM EST)
daily_prompt_execution_backup_600 = { schedule = "0 6 * * *", endpoint = "/daily-batch-trigger", method = "POST", headers = { "x-cron-secret" = "${CRON_SECRET}" }, body = "{\"force\": false, \"trigger_source\": \"scheduled_backup_600\"}" }

# === GUARDIAN: Hourly health check & auto-recovery ===
prompt_execution_guardian = { schedule = "15 * * * *", endpoint = "/prompt-execution-guardian", method = "POST", headers = { "x-cron-secret" = "${CRON_SECRET}" } }

# === MONITOR: Dead man's switch (every 15 minutes) ===
execution_monitor = { schedule = "*/15 * * * *", endpoint = "/execution-monitor", method = "POST", headers = { "x-cron-secret" = "${CRON_SECRET}" } }

# === LLUMOS SCORE: Weekly computation (Mondays at 8:05 AM UTC) ===
llumos_score_weekly = { schedule = "5 8 * * MON", endpoint = "/compute-llumos-score", method = "POST", headers = { "x-cron-secret" = "${CRON_SECRET}" }, body = "{\"scope\": \"org\", \"force\": true}" }
